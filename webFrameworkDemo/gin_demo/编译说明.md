# 编译说明

## 问题：在禁用 CGO 的电脑上编译失败

如果遇到 `Binary was compiled with 'CGO_ENABLED=0', go-sqlite3 requires cgo` 错误，请按照以下步骤操作：

## 解决方案

### 方法 1：禁用 CGO 编译（推荐，使用纯 Go 驱动）

```bash
# Windows PowerShell
$env:CGO_ENABLED="0"
go build -o app.exe .

# Windows CMD
set CGO_ENABLED=0
go build -o app.exe .

# Linux/Mac
CGO_ENABLED=0 go build -o app .
```

### 方法 2：使用构建标签排除 go-sqlite3

在编译时添加构建标签：

```bash
go build -tags "sqlite_omit_load_extension" -o app.exe .
```

### 方法 3：修改 go.mod 排除 go-sqlite3（不推荐）

如果以上方法都不行，可以尝试：

1. 编辑 `go.mod`，在 `require` 块中添加排除：

```go
exclude github.com/mattn/go-sqlite3 v1.14.22
```

2. 运行：

```bash
go mod tidy
go build -o app.exe .
```

## 验证编译

编译成功后，运行程序应该能正常连接数据库。

## 如果仍然失败

1. 确保已安装 `modernc.org/sqlite`：
   ```bash
   go get modernc.org/sqlite
   ```

2. 清理并重新下载依赖：
   ```bash
   go clean -modcache
   go mod download
   go mod tidy
   ```

3. 检查 `bootstrap` 目录中的驱动文件：
   - `sqlite_driver_nocgo.go` (禁用 CGO 时使用)
   - `sqlite_driver_cgo.go` (启用 CGO 时使用)

